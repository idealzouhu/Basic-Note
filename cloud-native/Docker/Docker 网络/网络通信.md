## 一、容器间通信

### 1.1 同一自定义网络中的容器通信

当你在同一个自定义网络中创建多个容器时，这些容器可以使用彼此的容器名称作为主机名进行通信。例如，如果你有两个容器 `web` 和 `db` 在同一个自定义网络中，`web` 容器可以通过 `db` 访问 `db` 容器的服务。

这个主要是通过自定义网络的 DNS 服务来实现的。



### 1.2 **跨自定义网络的容器通信**

容器在不同的自定义网络中时，它们**不能直接通过容器名称或 IP 地址通信**。这是因为 Docker 会隔离不同网络中的容器。

解决方案有：

- **使用网络间连接**：通过 Docker 提供的 `docker network connect` 命令，将一个容器连接到多个网络，从而允许它与这些网络中的容器通信。

  ```
  docker network connect my-network-1 my-container
  docker network connect my-network-2 my-container
  ```

- **使用端口映射**：如果一个容器在主机上通过端口映射暴露了服务，另一个网络中的容器可以通过主机的 IP 地址和映射的端口访问该服务。

  值得注意的是，为了让在不同网络中的容器访问通过端口映射暴露的服务，**使用主机的实际 IP 地址或 `host.docker.internal`**（在支持的情况下）是最佳做法。使用 `127.0.0.1` 会导致访问问题，因为它指向的是容器自身而不是主机。

**`host.docker.internal` 是一个特殊的 DNS 名称，用于在 Docker 容器中访问主机的网络服务。**这个名称在 Docker Desktop（Windows 和 macOS）中默认可用，允许容器通过这个地址与主机通信。





## 二、容器与外网通信

### 2.1 常规情况

**容器访问外网**：Docker 默认使用 **bridge** 网络模式，这使得容器可以通过 NAT（网络地址转换）访问外网。

**外网访问容器**：为了使外部用户能够访问容器服务，在启动容器的时候需要使用端口映射。





### 2.2 特殊情况

在使用 RocketMQ  Broker 的时候，broker.conf 会暴露 RocketMQ 的外网访问 IP 地址。

如果有其他不再同一个自定义网络下的容器想要访问 RocketMQ Broker 的话，这个 IP 不能为 127.0.0.1 和 `host.docker.internal`， 只能为主机的实际 IP 地址





## 参考资料

[Docker网络——实现容器间通信、容器与外网通信以及容器的跨主机访问-腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/article/1831540)