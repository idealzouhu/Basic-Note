

## 缓存穿透出现场景

[手摸手之注册用户如何防止缓存穿透？ (yuque.com)](https://www.yuque.com/magestack/12306/go6vg8whk9g1lyhp)

在高并发的会员注册场景下，可能会出现缓存穿透问题。主要原因可能是：

- 用户注册时，需要验证用户名是否已存在，这通常需要查询数据库。
- 如果缓存中没有该用户名，就会去数据库查询，如果数据库中也没有，就可以判断该用户名可用。
- 在高并发的情况下，可能有大量的新用户同时注册，输入的用户名极有可能都不存在于数据库中。这将导致大量的缓存不存在，都去查询数据库，造成数据库压力剧增。
- 且这些查询数据库的 Key 都不会被缓存，因为数据库中没有，不会写入缓存。那么这些 Key 对应的 Null 值也不会被缓存，造成每次请求都查不到缓存，直接查询数据库。
- 这样就形成了缓存穿透情况。









## 布隆过滤器缺陷

使用布隆过滤器，将所有已注册的用户名存入布隆过滤器，判断时先判断该用户名是否在布隆过滤器中，不在的一定不存在，避免直接查询数据库。

**但是，如果用户注销了账号，该用户名就可以再次被使用**。然而，布隆过滤器由于无法删除元素，因此无法处理这种情况。



## 最终检查方案



布隆过滤器 + 额外的一层缓存结构



多的一层缓存结构存在注销的用户名，用户解决布隆过滤器无法删除的问题。