[4.18 TCP 和 UDP 可以使用同一个端口吗？ | 小林coding (xiaolincoding.com)](https://xiaolincoding.com/network/3_tcp/port.html#多个-tcp-服务进程可以绑定同一个端口吗)



## 常见问题

> 注意第二个问题和第三个问题的区别
>
> 第二个问题是 服务端的进程
>
> 第三个问题是 客户端的进程

结论：TCP 和 UDP 可以同时绑定相同的端口；

原因：传输层有两个传输协议分别是 TCP 和 UDP，在内核中是两个完全独立的软件模块。



问题：多个 TCP 服务进程可以绑定同一个端口吗？

结论：不可以

现象：如果两个 TCP 服务进程同时绑定的 IP 地址和端口都相同，那么执行 **bind()** 时候就会出错，错误是“Address already in use”； 

原因：如果允许多个进程绑定到同一个端口上，**操作系统将无法正确地将传入的连接请求分发给相应的进程**，从而导致混乱和冲突。



问题：客户端的端口可以重复使用吗?

结论：在客户端执行 **connect()** 函数的时候，只要客户端连接的服务器不是同一个，内核允许端口重复使用。

原因：TCP 连接是由四元组（源IP地址，源端口，目的IP地址，目的端口）唯一确认的，那么只要四元组中其中一个元素发生了变化，那么就表示不同的 TCP 连接的。所以如果客户端已使用端口 64992 与服务端 A 建立了连接，那么客户端要与服务端 B 建立连接，还是可以使用端口 64992 的





问题：**重启 TCP 服务进程**时，为什么会有“Address in use”的报错信息？

结论： TCP 服务进程重启之后，总是碰到“Address in use”的报错信息，TCP 服务进程不能很快地重启，而是要过一会才能重启成功。

原因：当 TCP 服务进程重启时，服务端会出现 TIME_WAIT 状态的连接，TIME_WAIT 状态的连接使用的 IP+PORT 仍然被认为是一个有效的 IP+PORT 组合，相同机器上不能够在该 IP+PORT 组合上进行绑定，那么执行 bind() 函数的时候，就会返回了 Address already in use 的错误。



## TCP 连接

客户端是在调用 connect 函数的时候，由内核随机选取一个端口作为连接的端口

![img](images/tcp编程.png)