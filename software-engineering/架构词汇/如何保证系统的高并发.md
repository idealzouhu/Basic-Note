## 具体手段

在互联网分布式架构设计领域，如果想提高系统的并发能力，使得应用能扛住更多的并发请 求，主要有以下两种手段： 

- 纵向扩展 
- 横向扩展





## 纵向扩展

纵向扩展，就是提升单进程的处理能力。

#### 提升单节点硬件性能

通过增加内存、CPU核数、存储性能（如将机械硬盘升级为固态硬盘）等提升硬件性能的方 式来提升并发能力

#### 提升进程的软件性能

- 使用**各级缓存**，把计算结果缓存起来，减少耗时操作的次数

使用缓存来存储频繁访问的数据或者计算结果，减少对后端存储系统的访问压力(**冷热分离**思想)。缓存可以极大地提高系统的性能和吞吐量，同时减少对底层资源的消耗。



- 使用无锁模式和无锁数据结构来提升性能，减少处理时间



- 使用零复制来减少IO次数



- 使用异步操作来增加吞吐量

将一些耗时的操作或者不需要即时返回结果的操作进行异步处理。通过**消息队列**或者任务队列来缓冲和异步处理请求，从而降低系统的压力，提高系统的响应速度和吞吐量。



- 使用对象的池化机制，减少GC次数







## 横向扩展

横向扩展就是通过增加服务器数量来线性扩充系统性能。

**做好分层架构是横向扩展的前提**。首先，高并发系统往往业务复杂，通过分层处理可以简化 复杂问题，更容易做到横向扩展。其次，做好分层架构之后，可以更加方便地进行读写访问链路解 耦和冷热链路解耦，更容易做到靶向式的有效横向扩展。

常见的高并发系统在高并发架构上可以分为以下几层：

- 客户端层：用户使用的交互工具，包含浏览器Browser、手机APP等。

- 接入层：系统入口，反向代理。接入层的核心职责是接收用户请求，通过多种策略（如缓存策略）提升系统的读写吞吐量， 通过多种策略（如限流策略）防止系统雪崩，通过多种策略（如黑名单）提升系统的访问安全性。
- 服务层：实现核心应用逻辑，接收用户请求，处理完后返回HTML或者JSON。
- 缓存层：加速数据的访问。
- 数据库层：数据存储。
- 中间件：含分布式协调组件如ZooKeeper、消息队列如RocketMQ、搜索引擎如ElasticSearch等。



### 分层进行水平扩展

横向扩展的一条简单的原则是**：无状态水平扩容，有状态做分片路由**。

接入网关、业务服务层通常能设计成无状态的，可以很方便地进行水平扩容；而数据库层、缓存层往往是有状态的，因 此需要设计分区键做好存储分片。

#### 接入层水平扩展

负载均衡 Nginx。

动静分离，将静态资源和动态资源分离。在最接近使用的地方，把静态资源缓存 起来，从而提升静态资源的访问速度。   静态资源的缓存策略有：

- 接入层网关： 将静态资源的URL请求结果暂存到Nginx本地缓存
- CDN 加速： 缩短用户的请求距离，使用CDN进行静态资源加速



#### 服务层水平扩展

缓存层的高并发架构指的是在服务层和数据层直接加上一层分布式缓存中间件，实现数据的高并发写入/读取，从而提升性能、缓解数据库压力。

动态数据的分布式缓存中间件 Redis

三种经典的缓存模式： 

- 旁路缓存（Cache-Aside Pattern）模式。 
-  读/写穿透（Read/Write Through）模式。 
- 异步回写（Write Behind）模式。



#### 数据层水平扩展

数据层的横向扩展高并发架构主要包括两个方面： 

-  结构化数据的高并发架构方案：分库分表。 
-  异构数据、复杂查询的高并发架构方案：NoSQL 海量存储（如ElasticSearch、HBASE、 ClickHouse）。





### 访问链路解耦

比如可以将读写访问链路解耦，通过读写分离的方案提升读性能。当然，这种策略需要数据 库层、缓存层主从同步机制进行配合







### 参考资料

[“软件系统三高问题”高并发、高性能、高可用系统设计经验-阿里云开发者社区 (aliyun.com)](https://developer.aliyun.com/article/979134#:~:text=软件开发通常会提到一个名词 "三高"，即高并发、高性能、高可用。 具体的指标定义，如：高并发方面要求QPS 大于,10万；高性能方面要求请求延迟小于 100 ms；高可用方面要高于 99.99%。)