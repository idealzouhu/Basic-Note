

## IOC容器

### 1.IOC容器的认识

​    **IOC **（Inversion of Control）容器,是面向对象编程中的一种设计原则，以为“控制反转”。即将程序中创建对象的控制权交给Spring框架来管理，以便降低计算机代码之间的耦合度。
​       **IOC 容器**具有依赖注入功能的容器，它可以创建对象，IOC 容器负责实例化、定位、配置应用程序中的对象及建立这些对象间的依赖。通常new一个实例，控制权由程序员控制，而"控制反转"是指new实例工作不由程序员来做而是交给Spring容器来做。

例如：现有类 A 依赖于类 B

- **传统的开发方式** ： 往往是在类 A 中手动通过 new 关键字来 new 一个 B 的对象出来
- **使用 IoC 思想的开发方式** ： 不通过 new 关键字来创建对象，而是通过 IoC 容器(Spring 框架) 来帮助我们实例化对象。我们需要哪个对象，直接从 IoC 容器里面过去即可。

### 2 .IOC的实现方法

  IOC的实现方法主要有两种——依赖注入 与 依赖查找
  （1）依赖注入
  DI(依赖注入)　IoC的一个重点是在系统运行中，动态的向某个对象提供它所需要的其他对象。这一点是通过DI（Dependency Injection，依赖注入）来实现的。
  注入注解的语法：
  @Autowired     Spring为这个变量注入一个Bean
  @Inject 翻译为“注入”最易懂的注入注解
  @Resource 翻译为“资源”，可以理解为Spring往里面注入的时一个资源

### 3.SpringBoot IoC体现

​       在Spring中，你不需要自己创建对象，你只需要告诉Spring，哪些类我需要创建出对象，然后在启动项目的时候Spring就会自动帮你创建出该对象，并且只存在一个类的实例。这个类的实例在Spring中被称为Bean。而这种模式，我们称之为“单例模式”。也就是一个类只有一个实例的意思。  
  那么Spring是靠什么来了解究竟哪些类需要帮我们创建呢，这里介绍最常用的两种方式——JAVA注解配置，JAVA代码配置。之前的还有XML配置，groovy配置等，但是我们现在已经不推荐使用了。
  Spring会把注解@Controller、@Service、@Repository、@Component标注的类纳入Spring容器中进行管理。
  声明注解的语法：
  @Component 当前类是组件，没有明确的意思
  @Service 当前类在业务逻辑层使用
  @Repositorty 当前类在数据访问层使用
  @Controller 当前类在展现层（MVC）使用





# 依赖注入

## 控制翻转

在 Spring 环境下是等同的概念，控制翻转是通过依赖注入实现的。







## 依赖注入

依赖注入指的是容器负责创建对象和维护对象间的依赖关系,而不是通过对象本身负责自己的创建和解决自己的依赖。



## 依赖注入的实现

Spring loC 容器(ApplicationContext)负责创建 Bean，并通过容器将功能类 Bean 注入到你需要的 Bean 中。

Spring 提供使用 ml、注解、Java 配置、grooy 配置实现 Bean 的创建和注入



核心容器是Spring框架的基础，提供了依赖注入（DI）功能。核心容器的主要组件包括：

BeanFactory: 容器的核心，负责配置、创建和管理应用对象（称为Bean）。
ApplicationContext: BeanFactory的子接口，增加了对国际化、事件传播、资源加载等企业特定功能的支持。
Spring Expression Language (SpEL): 一种功能强大的表达式语言，用于在运行时查询和操作对象图。



# Spring 配置

## Spring 配置的发展历史

(1) 第一阶段：XML 配置。

 在 Spring 1.x 时代，使用 Spring 开发满眼都是 xml 配置的 Bean

(2) 第二阶段：注解配置。

 在Spring 2.x 时代，随着JDK 15 带来的注解支持，Spring 提供了声明 Bean 的注解(如 @Service)，大大减少了配置量。

(3) 第三阶段： Java配置

从Spring 3.x 到现在，Spring 提供了 Java 配置的能力，使用Java 配置可以让你更理解你配置的 Bean。**Spring 4.x 和 Spring Bot 都推荐使用 Java配置**

在 《 JavaEE开发的颠覆者 Spring Boot实战》中，注解配置和 Java 配置可以混合使用， 使用原则是： 全局配置使用 Java 配置(如数据库相关配置、MVC 相关配置)，业务 Bean 的配置使用注解配置(如 @Service、@Component、@Repository、@Controller)。





# Bean 的声明和注入

Spring loC 容器(ApplicationContext)负责创建 Bean，并通过容器将功能类 Bean 注入到
你需要的 Bean 中。

Spring 提供使用**配置元数据**的方式来实现 Bean 的创建和注入。配置元数据主要包括

-  xml配置
- 注解配置
- Java 配置
- groovy 配置

> 元数据即描述数据的数据。元数据本身不具备任何可执行的能力，只能通过外界代码来对这些元数据行解析后
> 进行一些有意义操作。

Spring 容器解析这些配置元数据进行 Bean 初始化、配置和管理依赖。



## XML 配置

在XML配置文件中使用`<bean>`元素声明bean，指定bean的ID（标识符）和类，如下所示：

```xml
<bean id="myBean" class="com.example.MyBean"/>
```



## Java 配置

Java 配置是 Spring 4.x 推荐的配置方式， 可以完全取代xml配置;  Java 配置也是 Spring Boot 推荐的配置方式。

Java 配置是通过 @Configuration 和 @Bean 来实现的。

- @Configuration 声明当前类是一个配置类，相当于一个 Spring 配置的xml文件
- @Bean 注解在方法上，声明当前方法的返回值为一个 Bean。

使用 Java 配置类，通过 `@Configuration` 注解声明配置类，再通过 `@Bean` 注解声明 Bean，如下所示：

```
@Configuration
public class AppConfig {
    @Bean
    public MyBean myBean() {
        return new MyBean();
    }
}
```



## 注解配置

使用注解方式，通过在 Java 类上添加`@Component`或其派生注解（如`@Service`、`@Repository`等）来声明 Bean，Spring会自动扫描并将其注册为 Bean。

```
@Component
public class MyBean {
    // Class implementation
}
```

声明 Bean 的注解主要有

- @Component 组件，没有明确的角色
- @Scrvice 在业务逻辑层(service 层)使用。
- @Repository 在数据访问层(dao 层)使用。
- @Controller 在展现层(MVC-Spring MVC)使用。

注入 Bean 的注解主要使用 Spring 提供的 @Autowired 。使用`@Autowired`注解，Spring会自动在容器中查找匹配类型的Bean进行注入。





# 补充

## 注解配置和 Java 配置区别

1. **语法：**
   - **注解配置：** 使用注解来标记bean，通常通过在类上添加`@Component`及其派生注解（如`@Service`、`@Repository`等）来声明bean。
   - **Java配置：** 使用Java类来声明bean，通常通过在Java配置类中使用`@Configuration`注解，然后在方法上使用`@Bean`注解来声明bean。
2. **灵活性：**
   - **注解配置：** 注解配置更加便捷，特别适用于小型项目或者简单的bean声明，因为它不需要额外的配置文件，所有的配置都可以直接写在Java类中。
   - **Java配置：** Java配置提供了更加灵活的方式来配置bean，可以在Java类中进行逻辑判断、循环等操作，生成bean的定义。这种方式更适合于复杂的配置场景，也更容易进行单元测试。
3. **可读性：**
   - **注解配置：** 注解配置可以使代码更加简洁，但当配置较多时，可能会使代码难以阅读和理解，特别是当多个注解组合使用时。
   - **Java配置：** Java配置可以将所有的配置逻辑都集中在一个或多个Java类中，使得配置更加清晰可读，便于维护和理解。
4. **类型安全：**
   - **注解配置：** 注解配置在一定程度上缺乏类型安全，因为注解的属性值通常是字符串，存在拼写错误等问题。
   - **Java配置：** Java配置是**类型安全的**，因为配置是通过Java代码实现的，编译器可以进行类型检查。

综上所述，注解配置适用于简单的bean声明和小型项目，而Java配置则更适合于复杂的配置场景和大型项目，因为它提供了更高的灵活性和可读性，并且具备类型安全性。

在 《 JavaEE开发的颠覆者 Spring Boot实战》中，使用原则是： 全局配置使用 Java 配置(如数据库相关配置、MVC 相关配置)，业务 Bean 的配置使用注解配置(@Service、@Component、@Repository、@Controller)。