在学习该中间件之间，首先了解一下数据分片的核心概念







[从零到一学习Sharding-JDBC | 拿个offer - 开源&项目实战 (nageoffer.com)](https://nageoffer.com/shardingsphere-jdbc/readme/#什么是-shardingsphere)





## 细节补充

分库分表后，不带用户分片键查询的危害

> 由于登录时没有带用户名，导致无法确定用户的分片键，使得系统无法直接锁定用户的数据位于哪个数据库或者哪张表中。为了找到用户的数据，只能对全部的数据库和表进行扫描查询，这就造成了所谓的**“读请求扩散”问题**。
>
> 也就是说，原本读请求可以直接定位到某个数据库某张表，现在却要多处查询，无疑大大增加了系统的查询负载。
>
> 一旦出现了读请求扩散问题，势必会导致用户的登录请求响应时间变长，严重的话还可能造成登录超时。



为了解决这个问题，我们引入了两张**路由表**：用户手机号表和用户邮箱表。这些表的核心字段是手机号和邮箱，以及它们对应的用户名。通过这样的设计，我们能够在用户登录时，灵活地使用手机号、邮箱或用户名来进行认证。







分库分表可能使用的算法：

- 基因法
- 订单号生成：为了保证订单号生成递增，我们参考雪花算法自定义了一个 `DistributedIdGenerator`，生成后的分布式 ID 再拼接上用户的后六位。



自定义分片算法： [手摸手之订单如何分库分表 (yuque.com)](https://www.yuque.com/magestack/12306/dyr1d4r3me19gg7l#wECos)



