### 什么是生产者—消费者问题

生产者－消费者问题描述了两类访问共享缓冲区的线程（即所谓的“生产者”和“消费者”） 在实际运行时会发生的问题。生产者线程的主要功能是生成一定量的数据放到缓冲区中，然后重复 此过程。消费者线程的主要功能是从缓冲区提取（或消耗）数据。

生产者―消费者问题关键是： 

- 保证生产者不会在缓冲区满时加入数据，消费者也不会在缓冲区中为空时消耗数据。 
- 保证在生产者加入过程、消费者消耗过程中，不会产生错误的数据和行为。





### 生产者—消费者模式

业内已经将解决该生产者—消费者问题的方案抽象成一种设计模式——“生产者－消费者”模式。“生产者－消费者”模式是一个 经典的多线程设计模式，它为多线程间的协作提供了良好的解决方案。

在生产者－消费者模式中，通常由两类线程，即生产者线程（若干个）和消费者线程（若干 个）。生产者线程向数据缓冲区（ `DataBuffer` ）加入数据，消费者线程则从 `DataBuffer` 消耗数据。

 ![image-20240829145919110](images/image-20240829145919110.png)

生产者－消费者模式中，至少有以下关键点： 

- 生产者与生产者之间、消费者与消费者之间，对数据缓冲区的操作是并发进行的。 
- 数据缓冲区是有容量上限的。数据缓冲区满后，生产者不能再加入数据；DataBuffer 空时， 消费者不能再取出数据。 
- 数据缓冲区是线程安全的。在并发操作数据区的过程中，不能出现数据不一致情况；或者 在多个线程并发更改共享数据后，不会造成出现脏数据的情况。 
- 生产者或者消费者线程在空闲时，需要尽可能阻塞而不是执行无效的空操作，尽量节约 CPU 资源





### 生产者-消费者的实现

`BlockingQueue` 就是生产者—消费者模式的经典实现。

