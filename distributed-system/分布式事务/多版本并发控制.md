### 什么是多版本并发控制

多版本并发控制可以看作在乐观并发控制的基础上增加了多个版本，即<font color="red">**为每个数据项存储多个版本**</font>。多版本并发控制有着非常好的读性能，适合实现快照隔离的隔离级别。

- 读操作：每个事务读到的都是某个版本的数据项
- 写操作：不覆盖已有的数据， 而是新建一个新的版本，直到 事务提交后才变为可见。因此， 正在执行写操作的事务就不会阻塞需要读取相同数据的事务。



在常见的并发控制协议基础上，主流的多版本并发控制有：

- 多版本两阶段锁 (Multi-VersionTwo-Phase Locking, MV2PL)
- 多版本乐观并发控制 (Multi-Version Optimistic Concurrency Control. MVOCC) 
- 多版本时间戳排序 (Multi-VersionTimestamp Ordering, MVTO)





### 版本存储和垃圾回收

多版本并发控制的代价是，每个数据项都存储多个版本是需要一定成本的。随着时间推移， 还需要一定的策略对过期的版本进行垃圾回收，以收回存储空间。

版本存储策略有：

- 仅追加存储
- 时间旅行存储
- 增量存储

垃圾回收策略有：

- 元组垃圾级别回收
- 事务垃圾级别回收